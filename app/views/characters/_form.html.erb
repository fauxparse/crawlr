<%= form.hidden_field :id %>
<div class="character-sheet">
  <section class="race">
    <%= race_selector form %>
  </section>

  <section class="abilities">
    <%= form.fields_for :abilities, form.object do |abilities| -%>
      <div class="strategy-and-points">
        <%= abilities.fields_for :strategy, form.object.ability_strategy do |strategy| %>
          <div class="strategy">
            <%= strategy.label :name, t("ability.strategy.name") %>
            <%= ability_strategy_selector strategy %>
          </div>

          <%= content_tag :div, class: "points", style: "#{"display: none" unless strategy.object.respond_to? :points_remaining}" do -%>
            <%= strategy.label :name, t("ability.strategy.points_remaining") %>
            <%= strategy.number_field :points_remaining, value: strategy.object.try(:points_remaining), disabled: true, min: 0 %>
          <% end -%>
        <% end -%>
      </div>

      <%= abilities.fields_for :stats, form.object do |stats| -%>
        <div class="stats">
          <%= render partial: "ability", collection: @character.abilities.sort.map { |a| AbilityPresenter.new(a) }, locals: { form: stats } %>
        </div>
      <% end -%>
    <% end -%>
  </section>
</div>
